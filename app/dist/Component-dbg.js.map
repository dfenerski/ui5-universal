{"version":3,"file":"Component-dbg.js","names":["models","_interopRequireDefault","__models","Component","UIComponent","extend","metadata","manifest","interfaces","init","_init","UIComponent.prototype.init.call","setModel","createDeviceModel","createAppModel","getRouter","initialize","SSR_CONTROLS","getRenderer","sap","ui","core","ElementMetadata","prototype","renderer","call","includes","getName","controlClass","getClass","render","onAfterRendering","rm","control","preservedContent","document","querySelector","getId","unsafeHtml","outerHTML","console","error","remove","getContentDensityClass","_getContentDensityClass","contentDensityClass","undefined","body","classList","contains","Device","support","touch"],"sources":["Component.ts"],"sourcesContent":["import Device from 'sap/ui/Device';\r\nimport Control from 'sap/ui/core/Control';\r\nimport RenderManager from 'sap/ui/core/RenderManager';\r\nimport UIComponent from 'sap/ui/core/UIComponent';\r\nimport models from './model/models';\r\n\r\n/**\r\n * @namespace com.github.dfenerski.ui5_ssr\r\n */\r\nexport default class Component extends UIComponent {\r\n    public static metadata = {\r\n        manifest: 'json',\r\n        interfaces: ['sap.ui.core.IAsyncContentCreation'],\r\n    };\r\n\r\n    private contentDensityClass: string;\r\n\r\n    public init(): void {\r\n        // call the base component's init function\r\n        super.init();\r\n\r\n        // create the device model\r\n        this.setModel(models.createDeviceModel(), 'device');\r\n\r\n        // create the app model\r\n        this.setModel(models.createAppModel(), 'app');\r\n\r\n        // create the views based on the url/hash\r\n        this.getRouter().initialize();\r\n\r\n        const SSR_CONTROLS = ['sap.m.Page'];\r\n        // @ts-expect-error behold\r\n        const getRenderer = sap.ui.core.ElementMetadata.prototype.getRenderer;\r\n        // @ts-expect-error behold\r\n        sap.ui.core.ElementMetadata.prototype.getRenderer = function () {\r\n            const renderer = getRenderer.call(this);\r\n            //\r\n            if (SSR_CONTROLS.includes(this.getName())) {\r\n                const controlClass = this.getClass();\r\n                const render = renderer.render;\r\n                const onAfterRendering =\r\n                    controlClass.prototype.onAfterRendering;\r\n                renderer.render = function (\r\n                    rm: RenderManager,\r\n                    control: Control,\r\n                ) {\r\n                    // const preservedContent$ = <any>(\r\n                    //     RenderManager.findPreservedContent(control.getId())\r\n                    // );\r\n                    const preservedContent = document.querySelector(\r\n                        `#sap-ui-ssr #${control.getId()}`,\r\n                    );\r\n                    if (preservedContent) {\r\n                        // preservedContent.remove();\r\n                        rm.unsafeHtml(preservedContent.outerHTML);\r\n                        console.error('Preserved content rendered');\r\n                        return;\r\n                    }\r\n                    render.call(renderer, rm, control);\r\n                };\r\n                controlClass.prototype.onAfterRendering = function () {\r\n                    const preservedContent = document.querySelector(\r\n                        `#sap-ui-ssr #${this.getId()}`,\r\n                    );\r\n                    if (preservedContent) {\r\n                        preservedContent.remove();\r\n                    }\r\n                    onAfterRendering.call(this);\r\n                };\r\n            }\r\n            return renderer;\r\n        };\r\n    }\r\n\r\n    /**\r\n     * This method can be called to determine whether the sapUiSizeCompact or sapUiSizeCozy\r\n     * design mode class should be set, which influences the size appearance of some controls.\r\n     * @public\r\n     * @returns css class, either 'sapUiSizeCompact' or 'sapUiSizeCozy' - or an empty string if no css class should be set\r\n     */\r\n    public getContentDensityClass(): string {\r\n        if (this.contentDensityClass === undefined) {\r\n            // check whether FLP has already set the content density class; do nothing in this case\r\n            if (\r\n                document.body.classList.contains('sapUiSizeCozy') ||\r\n                document.body.classList.contains('sapUiSizeCompact')\r\n            ) {\r\n                this.contentDensityClass = '';\r\n            } else if (!Device.support.touch) {\r\n                // apply \"compact\" mode if touch is not supported\r\n                this.contentDensityClass = 'sapUiSizeCompact';\r\n            } else {\r\n                // \"cozy\" in case of touch support; default for most sap.m controls, but needed for desktop-first controls like sap.ui.table.Table\r\n                this.contentDensityClass = 'sapUiSizeCozy';\r\n            }\r\n        }\r\n        return this.contentDensityClass;\r\n    }\r\n}\r\n"],"mappings":"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","ignoreList":[]}